<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/> 
    <link rel="stylesheet" type="text/css" href="./AUI/css/aui.css" />

    <link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">

    <link rel="stylesheet" href="./jquery-weui/css/jquery-weui.css">

    <script type = "text/javascript" src = "./jquery-3.2.1/jquery-3.2.1.min.js"></script> 
   <!-- <link data-th-href="@{/jquery-weui/css/jquery-weui.min.css}" rel="stylesheet"> -->


	
	<title>购物车</title>

</head>

<body>

<section class="" style="margin-bottom:50px; " id=border>

<div class="weui-cells weui-cells_checkbox"  id="content">

	<div id="pop_select" class="weui-popup__container popup-bottom" style="z-index: 999; ">
		<div class="weui-popup__overlay"></div>
		<div class="weui-popup__modal">
			<div class="toolbar">
				<div class="toolbar-inner">
					<a href="javascript:;" class="picker-button close-popup">关闭</a>
					<h1 class="title">添加检测人</h1>
				</div>
			</div>
			<div class="modal-content">
				<div class="weui-cells">
					<div class="weui-cell">
						<a class="weui-cell__bd" href="#">
							检测人1
						</a>
						<a class="weui-cell__ft">添加</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="pop_write" class="weui-popup__container " style="z-index: 999; ">
		<div class="weui-popup__overlay"></div>
		<div class="weui-popup__modal">
			<h1>信息填写</h1>
		</div>
	</div>
<!--
	<div class="weui-panel weui-panel_access">

		<div class="weui-panel__bd">
			<div class="weui-cell">
				<label class="weui-cell__hd weui-check__label">
					<input type="checkbox" class="weui-check" name="checkbox" checked="checked">
					<i class="weui-icon-checked"></i>
				</label> 
				<div class="weui-cell__bd">
					<div class="weui-media-box weui-media-box_appmsg">
						<div class="weui-media-box__hd">
							<img class="weui-media-box__thumb" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1505831449&di=bdfe5ce42a5f422a8cc4926dbd8d73a7&imgtype=jpg&er=1&src=http%3A%2F%2Fimg.jsqq.net%2Fuploads%2Fallimg%2F140323%2F1_140323064336_4.jpg">
						</div>
						<div class="weui-media-box__bd">
							<h4 class="weui-media-box__title" style="width:91px;word-wrap:break-word; word-break:normal;font-size: 13px;">糖尿病早期筛查</h4>
							<div class="weui-media-box__desc">
								<p >金额:￥50</p>
							</div>
						</div>

					</div>
				</div>
				<div class="weui-cell__ft">
					<div class="aui-bar aui-bar-btn aui-bar-btn-sm" style="width:72px">
						<div class="aui-bar-btn-item" name="decrement">
							<i class="aui-iconfont aui-icon-minus"></i>
						</div>
						<div class="aui-bar-btn-item">
							<input type="number" disabled="true" class="aui-input aui-text-center" value="1" >
						</div>
						<div class="aui-bar-btn-item" name="increment">
							<i class="aui-iconfont aui-icon-plus"></i>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="weui-panel__ft">
			<a href="javascript:void(0);" class="weui-cell weui-cell_access weui-cell_link" name="showPeople">
				<div class="weui-cell__hd"></div>
				<div class="weui-cell__bd">检测人</div>
				<span class="weui-cell__ft"></span>
			</a>
			<ul class="people-ist" name="people_list" style="display: none">
				<li class="weui-cell weui-cell_link">
					<div class="weui-cell__hd"></div>
					<div class="weui-cell__bd" name="">李狗蛋</div>
					<div class="weui-cell__ft">
						<i class="weui-icon-cancel" name="delete"></i>
					</div>
				</li>
				<li>
					<div style="display:flex; justify-content:center; margin: 10px auto;">
					<div class="weui-btn weui-btn_mini weui-btn_primary" name="add">添加检测人</div>
					</div>

				</li>
			</ul>
		</div>
	</div>
-->
</div>





</section>

<footer class="aui-bar aui-bar-tab"> 

	<div class="weui-btn weui-btn_primary aui-bar-tab-item"  onclick="Buy()" tapmode>购买</div>
	
</footer>


</body>


<!--
<script type="text/javascript" src="./AUI/script/aui-dialog.js" ></script>

<script data-th-src="@{/AUI/script/aui-dialog.js}" ></script>
<script data-th-src="@{/jquery-weui/js/jquery-weui.min.js}"></script>
-->

<script type="text/javascript" src="./jquery-weui/js/jquery-weui.min.js" ></script>

<script type="text/javascript">
	 var context = /*[[${#httpServletRequest.getScheme() + "://" + #httpServletRequest.getServerName() + ":" + #httpServletRequest.getServerPort() + #httpServletRequest.getContextPath()}]]*/;

	var cartData={};

	var unit_price=[];

	$(document).ready(
		GetCartData(),
		Draw()
	);

	function GetCartData(){


		var path = context +  '/show_cart_info';

				//获取购物车信息
				/*var cartDataXml = $.ajax({
		            cache: true,
		            type: "GET",
		            url: path,
		            data: "get shopping car info",// 
		            dataType:json,
		            async: false,
		            error: function (request) {
		                
		            },
		            success: function (data) {
		                cartData = data
		            }
		        });*/
		        cartData = {

		        	"result":"ok",

		        	"errMsg":"",

		        	"parm":[

		        	{
		        		"cart_id":"",
		        		"cart_itemid":"1230",
		        		"product_id":"32132146-4564-56465",
		        		"product_name":"糖尿病早期筛查",
		        		"unit_price":0.01,
		        		"quantity":3

		        	},
		        	{
		        		"cart_id":"",
		        		"cart_itemid":"1230",
		        		"product_id":"32132146-4564-56465",
		        		"product_name":"肾病早期筛查",
		        		"unit_price":0.01,
		        		"quantity":3

		        	}
		        	]

		        };
		    }

		    function Draw(){

		    	var html;


		    	if (cartData.result=="ok") {

		    		for (var i = cartData.parm.length - 1; i >= 0; i--) {
		    			unit_price[cartData.parm[i].product_name] = cartData.parm[i].unit_price;

		    			html  = '<div class="weui-panel weui-panel_access">'

		    			html += '<div class="weui-panel__bd">'
		    			html += '<div class="weui-cell">'
		    			html += '<label class="weui-cell__hd weui-check__label">'
		    			html += '<input type="checkbox" class="weui-check" name="checkbox" checked="checked">'
		    			html += '<i class="weui-icon-checked"></i>'
		    			html += '</label> '
		    			html += '<div class="weui-cell__bd">'
		    			html += '<div class="weui-media-box weui-media-box_appmsg">'
		    			html += '<div class="weui-media-box__hd">'
		    			html += '<img class="weui-media-box__thumb" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1505831449&di=bdfe5ce42a5f422a8cc4926dbd8d73a7&imgtype=jpg&er=1&src=http%3A%2F%2Fimg.jsqq.net%2Fuploads%2Fallimg%2F140323%2F1_140323064336_4.jpg">'
		    			html += '</div>'
		    			html += '<div class="weui-media-box__bd">'
		    			html += '<h4 class="weui-media-box__title" style="width:91px;word-wrap:break-word; word-break:normal;font-size: 13px;">'+cartData.parm[i].product_name+'</h4>'
		    			
		    			html += '<div class="weui-media-box__desc">'
		    			html += 	'<p>金额：￥'+(cartData.parm[i].unit_price*cartData.parm[i].quantity)+'</p>'
		    			html += '</div>'
		    			html += '</div>'

		    			html += '</div>'
		    			html += '</div>'
		    			html += '<div class="weui-cell__ft">'
		    			html += '<div class="aui-bar aui-bar-btn aui-bar-btn-sm" style="width:72px">'
		    			html += 	'<div class="aui-bar-btn-item" name="decrement">'
		    			html += 	'<i class="aui-iconfont aui-icon-minus"></i>'
		    			html += '</div>'
		    			html += '<div class="aui-bar-btn-item">'
		    			html += 	'<input type="number" disabled="true" class="aui-input aui-text-center" value="'+cartData.parm[i].quantity+'" >'
		    			html += '</div>'
		    			html += '<div class="aui-bar-btn-item" name="increment">'
		    			html += '<i class="aui-iconfont aui-icon-plus"></i>'
		    			html += '</div>'
		    			html += '</div>'
		    			html += '</div>'
		    			html += '</div>'
		    			html += '</div>'
		    			html += '<div class="weui-panel__ft">'
		    			html += '<a href="javascript:void(0);" class="weui-cell weui-cell_access weui-cell_link" name="showPeople">'
		    			html += '<div class="weui-cell__hd"></div>'
		    			html += '<div class="weui-cell__bd">检测人</div>'
		    			html += 				'<span class="weui-cell__ft"></span>'
		    			html += 			'</a>'
		    			html += 		'<ul class="people-ist" name="people_list" style="display: none">'			
		    			html += 	'<li>'
		    			html += '<div style="display:flex; justify-content:center; margin: 10px auto;">'
		    			html += 	'<div class="weui-btn weui-btn_mini weui-btn_primary" name="add">添加检测人</div>'
		    			html += 	'</div>'

		    			html += '</li>'
		    			html += '</ul>'
		    			html += '</div>'
		    			html += '</div>'


		    			$('#content').append(html);


		    		}

		    	}else{
		    		alert('获取购物车信息失败');
		    	}

		    }
	//查询购物车项目对应的患者信息
	function GetPeopleofCartInfo(req){
		var patientInfo;
		var path = context + "";
		/*var patientInfoXml = $.ajax({
		            cache: true,
		            type: "GET",
		            url: path,
		            data: "get shopping car info",// 
		            dataType:json,
		            async: false,
		            error: function (request) {
		                
		            },
		            success: function (data) {
		                patientInfo = data
		            }
		        });*/
		if (patientInfoXml.response == '200') {

		}else{
			return patientInfo;
		}

	}


	//减少数量
	$('div[name=decrement]').click(function Decrement(e){
		var priceNode =  $(this).parent().parent().prev().find("p");
		var countNode = $(this).next().children();
		if (parseInt(countNode.val())>1) {
			
			var unit_price = GetUnitPrice($(this).parent().parent().prev().find("h4").text());
			countNode.val(parseInt(countNode.val())-1);
			/*$.ajax({

			});*/
			priceNode.text("金额：￥"+(unit_price*countNode.val()));
		}else{
			//订单数等于0 删除
			$.confirm({
				title: '确认删除',
				text: '确认删除该订单吗？',
				onOK: function () {
			    //点击确认
			    /*$.ajax({

			    });*/
			    priceNode.parent().parent().remove();
			},
			onCancel: function () {
			  	//点击取消

			  }
			});
			
		}
	})

	//增加数量
	$('div[name=increment]').click(function Increment(e){
		var priceNode =  $(this).parent().parent().prev().find("p");
		var countNode = $(this).prev().children();
		if (countNode.val()<9) {
			var unit_price = GetUnitPrice($(this).parent().parent().prev().find("h4").text());
			countNode.val(parseInt(countNode.val())+1);

			/*$.ajax({

			});*/

			priceNode.text("金额：￥"+(unit_price*countNode.val()));
		}
		
	})

	//弹出检测人框
	$('a[name=showPeople]').click(function(e){
		$(this).next().slideDown();
		//获取购物车检测人名单/已保存的检测人


		e.stopPropagation();
	});

	
	//收回检测人框
	$(document).click(function(e){
		$('ul[name=people_list]').slideUp();
	});
	
	//添加检测人
	$("div[name=add]").click(function(e){
		//弹出已保存的人名单，无保存的填写信息
		if(true){
			//弹出检测人选择框
			$("#pop_select").popup();
		}else{
			//弹出全屏的信息填写框
			$("#pop_write").popup();
		}
		e.stopPropagation();
	})

	//删除检测人
	$("i[name=delete]").click(function(e){
		e.stopPropagation();
	});

	//阻止添加检测人框触发的冒泡事件
	/*$("#pop").click(function(e){
		e.stopPropagation();
	})*/



    //获得单价
    function GetUnitPrice(product){
    	return unit_price[product];
    }

	//购买
	function Buy(){
		
		/*$.ajax({
            cache: true,
            type: "POST",
            url: ,
            data: ,
            async: false,
            error: function (request) {
                alert("Connection error");
            },
            success: function (data) {
                
            }
        });*/
    }
</script>

<style type="text/css">
	.people-list{
		margin-left: 10px;

	}

	.input-number {
	  width: 80px;
	  padding: 0 12px;
	  vertical-align: top;
	  text-align: center;
	  outline: none;

	}

	.input-number,
	.input-number-decrement,
	.input-number-increment {
	  border: 1px solid #dddddd;
	  height: 40px;
	  user-select: none;
	}

	.input-number-decrement,
	.input-number-increment {
	  display: inline-block;
	  width: 30px;
	  line-height: 38px;
	  background: #f1f1f1;
	  color: #444444;
	  text-align: center;
	  font-weight: bold;
	  cursor: pointer;
	}
	.input-number-decrement:active,
	.input-number-increment:active {
	  background: #dddddd;
	}

	.input-number-decrement {
	  border-right: none;
	  border-radius: 0px 0 0 0px;
	}

	.input-number-increment {
	  border-left: none;
	  border-radius: 0 0px 0px 0;
	}

	.count-eare{
		display: flex;
		flex-direction: row;

		width: 100px;
		

	}
	.my-btn{

		font-size: 15px;
	}
	.num-input{

	}
</style>

</html>